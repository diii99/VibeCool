import{j as m}from"./v1-chunk-KWARAS4N.js";var f=class{warn(e,...r){throw new Error("Not implmeneted!")}info(e,...r){throw new Error("Not implmeneted!")}error(e,...r){throw new Error("Not implmeneted!")}table(e,...r){throw new Error("Not implmeneted!")}};var u=class extends f{info(){}warn(){}error(){}table(){}};var g=new u;function F(d,e){let r=new RegExp(`${e}.(\\S+)`,"g"),t=d.match(r);if(t&&t.length)return t[0].split(".")[1]}function N(d,e){let r=e.el.querySelectorAll(`[data-js-target*="${d}."]`);for(let o of r){let s=o;if(s.dataset.jsTarget){let i=s.dataset.jsTarget.split(" ").filter(a=>a.includes(`${d}.`)).map(a=>a.split(".")[1]);for(let a of i)e[a]=o}}let t,n=Array.from(e.el.querySelectorAll(`[data-js-target-list*="${d}."]`)).reduce((o,s)=>{let i=s;return t=F(i.dataset.jsTargetList,d),t&&(o[t]?o[t].push(i):o[t]=[i]),o},{});Object.keys(n).forEach(o=>{e[o]=n[o]})}function x(d){return d.sort((e,r)=>e.el===r.el?0:e.el.compareDocumentPosition(r.el)&Node.DOCUMENT_POSITION_PRECEDING?1:-1)}var w=class{static get allDependencies(){return[...this.dependencies,...this.optionalDependencies]}constructor(e){this.__childControllers=e}__initMemembers(e,r){this.el=r,this.__domId=e,N(e,this)}connect(){return m(this,null,function*(){})}disconnect(){}reconnect(){return this.disconnect(),this.__initMemembers(this.__domId,this.el),this.connect()}childController(e){if(!this.constructor.allDependencies.includes(e))throw new Error(`Cannot search for unregistered dependency ${e.name}`);for(let t of this.__childControllers)if(t instanceof e)return t}childControllers(e){if(!this.constructor.allDependencies.includes(e))throw new Error(`Cannot search for unregistered dependency ${e.name}`);let t=[];for(let n of this.__childControllers)n instanceof e&&t.push(n);return x(t)}trackEvent(e){return m(this,null,function*(){var r;e.url=(r=e.url)!=null?r:window.location.href;try{let{Analytics:t}=yield import("./v1-analytics-XE27SI5U.js");t.trackEvent(e)}catch(t){let{category:n,label:o}=e,s=`Cannot track interactions for ${n}: ${o}.`;g.warn(`Failed to load tracking/analytics ${s}`,t)}})}initializeAnalytics(){return m(this,null,function*(){try{let{Analytics:e}=yield import("./v1-analytics-XE27SI5U.js");return yield e.initialize(),e}catch(e){g.warn("[Analytics] Could not load analytics module, will not initialize")}})}};w.dependencies=[],w.optionalDependencies=[];var M=class{constructor(e){this.__instancesByControllerAndDomNode=new Map;this.__registry=e}__controllersFromString(e){var t;let r=new Set;return(t=e==null?void 0:e.split(" "))==null||t.forEach(n=>{let o=this.__registry.controllersById.get(n);o&&r.add(o)}),r}__controllersForNode(e){return this.__controllersFromString(e.dataset.jsController)}nodesForController(e,r){let n=`[data-js-controller~=${this.__registry.idForController(r)}]`,o=new Set;e.matches(n)&&o.add(e);for(let s of e.querySelectorAll(n))o.add(s);return o}instanceForNode(e,r){let t=this.__instancesByControllerAndDomNode.get(e);if(t)return t.get(r)}setNodeInstance(e,r){let t=e.constructor,n=this.__instancesByControllerAndDomNode.get(t);n||(n=new Map,this.__instancesByControllerAndDomNode.set(t,n)),n.set(r,e)}removeNodeInstance(e){let r=e.constructor,t=this.__instancesByControllerAndDomNode.get(r);t||(t=new Map,this.__instancesByControllerAndDomNode.set(r,t));for(let[n,o]of t.entries())o===e&&t.delete(n)}observeDOM(e,{onControllerNodesAdded:r,onControllerNodesRemoved:t}){let n=new MutationObserver(o=>{let s=new Set,i=new Set;for(let a of o){for(let l of a.addedNodes)if(l instanceof HTMLElement){let c=new Set(l.querySelectorAll("[data-js-controller]"));l.matches("[data-js-controller]")&&c.add(l),c.forEach(_=>{this.__controllersForNode(_).forEach(y=>{s.add([_,y])})})}for(let l of Array.from(a.removedNodes))if(l instanceof HTMLElement){let c=new Set(l.querySelectorAll("[data-js-controller]"));l.matches("[data-js-controller]")&&c.add(l),c.forEach(_=>{this.__controllersForNode(_).forEach(y=>{var C;let h=(C=this.__instancesByControllerAndDomNode.get(y))==null?void 0:C.get(_);h&&i.add(h)})})}if(a.type==="attributes"){let l=a.target;if(l instanceof HTMLElement){let c=this.__controllersForNode(l);this.__controllersFromString(a.oldValue).forEach(y=>{var h;if(!c.has(y)){let C=(h=this.__instancesByControllerAndDomNode.get(y))==null?void 0:h.get(l);C&&i.add(C)}}),c.forEach(y=>{var h;(h=this.__instancesByControllerAndDomNode.get(y))!=null&&h.has(l)||s.add([l,y])})}}}s.size>0&&r(s),i.size>0&&t(i)});return n.observe(e,{attributes:!0,attributeFilter:["data-js-controller"],attributeOldValue:!0,subtree:!0,childList:!0}),()=>n.disconnect()}};var T={ToRoots:"ToRoots",ToLeaves:"ToLeaves"},p=class{constructor(){this.__verticies=new Map}add(e){let r=this.__verticies.get(e);return r||(r={value:e,dependsOn:new Set,dependedOnBy:new Set},this.__verticies.set(e,r)),r}vertex(e){let r=this.__verticies.get(e);if(!r)throw new Error("Vertex not found in DAG!");return r}*walk(e,r,t=new Set,n=[]){let o=this.__verticies.get(e);if(!o||t.has(e))return;let s=r===T.ToRoots;n.push(e),t.add(e),s||(yield[o,n]);let i=s?o.dependedOnBy:o.dependsOn;for(let a of i)yield*this.walk(a,r,t,n);s&&(yield[o,n]),n.pop()}addEdge(e,r){if(e===r)return;let t=this.add(e),n=this.add(r);if(!n.dependedOnBy.has(e)){for(let[o,s]of this.walk(e,T.ToRoots))if(o.value===r)throw new Error(`Circular dependency detected: ${s.join(" -> ")}`);n.dependedOnBy.add(e),t.dependsOn.add(r)}}};var E=class{constructor(){this.__controllersById=new Map;this.__idsByController=new Map;this.__classHierarchy=new p}get controllersById(){return this.__controllersById}register(e,r){if(this.__controllersById.has(e))throw new Error(`A controller is already registered with id "${e}"`);if(this.__idsByController.has(r)){let t=this.__idsByController.get(r);if(t)throw new Error(`Attempted to register a controller under two names "${e}" and "${t}"`)}this.__classHierarchy.add(r);for(let t of this.__controllersById.values())Object.getPrototypeOf(t)===r?this.__classHierarchy.addEdge(r,t):Object.getPrototypeOf(r)===t&&this.__classHierarchy.addEdge(t,r);this.__controllersById.set(e,r),this.__idsByController.set(r,e)}withSubclasses(e){let r=new Set;for(let[t]of this.__classHierarchy.walk(e,T.ToLeaves))r.add(t.value);return r}idForController(e){let r=this.__idsByController.get(e);if(!r)throw new Error(`Cannot get id for unregistered controller ${e.name}`);return r}};var A=class{constructor(){this.__requiredDependencyGraph=new p;this.__optionalDependencyGraph=new p}register(e){this.__requiredDependencyGraph.add(e),this.__optionalDependencyGraph.add(e);for(let r of e.dependencies)this.__requiredDependencyGraph.addEdge(e,r),this.register(r);for(let r of e.optionalDependencies)this.__optionalDependencyGraph.addEdge(e,r),this.register(r)}dependencies(e){let r=this.__requiredDependencyGraph.vertex(e),t=[...r.dependsOn].map(o=>({dependency:o,required:!0})),n=[...this.__optionalDependencyGraph.vertex(e).dependsOn].filter(o=>!r.dependsOn.has(o)).map(o=>({dependency:o,required:!1}));return new Set([...t,...n])}};var S=class{constructor(e,r){this.__dependencyManager=new A;this.__connectPromises=new Map;this.__domManager=e,this.__registry=r}__initChildren(e,r){return m(this,null,function*(){let t=[];for(let{dependency:s,required:i}of this.__dependencyManager.dependencies(e)){let a=[];for(let l of this.__registry.withSubclasses(s))a.push(this.initController(l,r));t.push({required:i,dependency:s,promises:a})}let o=(yield Promise.all(t.map(({promises:s})=>Promise.all(s)))).reduce((s,i)=>[...s,new Set([...i].reduce((a,l)=>[...a,...l],[]))],[]);return o.forEach((s,i)=>{if(t[i].required&&s.size<=0)throw new Error(`Missing required child Controller "${t[i].dependency.name}" for Controller "${e.name}"`)}),new Set(o.reduce((s,i)=>[...s,...i],[]))})}initController(e,r){return m(this,null,function*(){if(!r)throw new Error("Missing node for controller!");this.__dependencyManager.register(e);let t=this.__domManager.nodesForController(r,e),n=this.__registry.idForController(e),o=new Set,s=[];for(let l of t)s.push([l,this.__initChildren(e,l)]);let i=new Map;(yield Promise.all(s.map(([,l])=>l))).forEach((l,c)=>{i.set(s[c][0],l)});let a=[];for(let l of t){let c=this.__domManager.instanceForNode(e,l);if(c){o.add(c);let _=this.__connectPromises.get(c);_&&a.push(_)}else{c=new e(i.get(l)||new Set),o.add(c),this.__domManager.setNodeInstance(c,l),c.__initMemembers(n,l);let _=c.connect();a.push(Promise.resolve().then(()=>_))}}yield Promise.all(a);for(let l of o)this.__connectPromises.delete(l);return o})}destructController(e){e.disconnect(),this.__domManager.removeNodeInstance(e)}};function D(d){return Promise.all(d.map(e=>e.then(r=>({status:"fulfilled",value:r})).catch(r=>({status:"rejected",reason:r}))))}var v=class{constructor(e){this.__registry=new E;this.__domManager=new M(this.__registry);this.__instanceManager=new S(this.__domManager,this.__registry);this.__started=!1;this.__onNodesAdded=e=>{this.__initControllers(e)};this.__onNodesRemoved=e=>{for(let r of e)this.__instanceManager.destructController(r)};this.__rootNode=e}register(e,r){return m(this,null,function*(){this.__registry.register(e,r),this.__started&&(yield this.__startController(r,this.__rootNode))})}start(){return m(this,null,function*(){this.__started=!0,this.__domManager.observeDOM(this.__rootNode,{onControllerNodesAdded:this.__onNodesAdded,onControllerNodesRemoved:this.__onNodesRemoved}),yield this.__initControllers(new Set([...this.__registry.controllersById.values()].map(e=>[this.__rootNode,e])))})}__initControllers(e){return m(this,null,function*(){let r=[];for(let[n,o]of e)r.push(this.__startController(o,n));(yield D(r)).forEach(n=>{n.status==="rejected"&&g.error(n.reason)})})}__startController(e,r){return this.__instanceManager.initController(e,r)}},ee=new v(document.documentElement);export{g as a,w as b,ee as c};
